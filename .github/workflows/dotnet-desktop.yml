name: .NET Core Desktop Build and Release

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:

  build:

    runs-on: windows-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Install .NET Core
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 8.0.x

    # 恢复NuGet包（使用解决方案）
    - name: Restore NuGet packages
      run: dotnet restore Sap2000MeshGenerator/Sap2000MeshGenerator.sln

    # 编译解决方案（不指定RID）
    - name: Build solution
      run: dotnet build Sap2000MeshGenerator/Sap2000MeshGenerator.sln --configuration Release --no-restore

    # 发布项目（在项目级别指定RID）
    - name: Publish executable
      run: |
        dotnet publish Sap2000MeshGenerator/Sap2000MeshGenerator.csproj `
          --configuration Release `
          --runtime win-x64 `
          --output ./publish/ `
          --self-contained true `
          /p:PublishSingleFile=true `
          /p:IncludeNativeLibrariesForSelfExtract=true
      
    - name: Upload executable artifacts
      uses: actions/upload-artifact@v4
      with:
        name: SAPMesh-Executable
        path: ./publish/
        retention-days: 30
